import{Q as A,R as B,U as I,r as f,k as e,F as x,t as n,bH as te,j as u,B as E,az as W,bI as N,Z as ne,g as $,aM as ae,aN as re,aO as oe,x as C,T as r,bC as F,aP as ie,bA as le,bJ as se,bK as ce,bL as pe,c as b,b as R,S as de,a as ue,aI as he,v as D,aA as j,y as fe,z as me,A as Se,bD as ve,ai as ye,aw as ge,ab as V,ac as xe,av as G}from"./index.2b056f30.js";import{N as be,P as Ce}from"./PageContent.5c764c80.js";import{d as ke}from"./ConfirmationDialog.8a86d4c9.js";import{A as De}from"./ActionBar.eaca503d.js";import{B as L}from"./ButtonMenu.1f736b86.js";import{u as z,g as Y,f as q,m as _e,s as we,S as Te,a as Fe,b as Re,v as Ee,G as H}from"./fleetSetupValidation.f1b00672.js";import{d as $e,a as J,b as Ae,I as Be,E as Ie}from"./ExportDataDialog.755bbaf7.js";import{d as Oe}from"./Save.15909dcd.js";import{E as Pe}from"./ExpandStack.7f40edab.js";import{R as Me}from"./ResponsiveDialog.ac3922e7.js";import{T as We}from"./TextField.0b66033f.js";import{P as Ne}from"./PageFooter.a8b831cb.js";import{A as je}from"./Alert.d1904e5f.js";import"./MenuItem.2116f85c.js";import"./DialogContentText.7619c583.js";import"./domUtils.df855419.js";import"./Popper.b61f1969.js";import"./ClickAwayListener.8dba0913.js";import"./Download.a25e063e.js";import"./Select.c9eac106.js";import"./useFormControl.1350e2fd.js";var O={},Ve=B.exports;Object.defineProperty(O,"__esModule",{value:!0});var U=O.default=void 0,Ge=Ve(A),ze=I,He=(0,Ge.default)((0,ze.jsx)("path",{d:"M16 7c0 2.21-1.79 4-4 4S8 9.21 8 7s1.79-4 4-4 4 1.79 4 4zm-9 6c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm10 0c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4z"}),"Spoke");U=O.default=He;const Ke=p=>{const{fleetSetups:t,fleetSetup:s,onChange:i,buttonProps:l}=p,o=f.exports.useMemo(()=>t.map(a=>({key:a.key,text:a.name,value:a.key})),[t]);return e(x,{children:e(L,{icon:e(U,{}),text:n("fleetSetup.selectFleet"),value:s.key,options:o,onClick:i,buttonProps:l})})},Le=p=>{const{fleetSetup:t,grouping:s,onCopyAsText:i,buttonProps:l}=p,[o,a]=f.exports.useState(!1),[h,d]=f.exports.useState(!1),y=f.exports.useCallback((g,c)=>{(async()=>{const v=await te();if(!v){c();return}const S=z(v,t.key);g(S)})()},[t]),m=f.exports.useCallback(g=>{let c;try{c=JSON.parse(g)}catch(v){return console.log(v),null}return z(c,t.key)},[t]),k=f.exports.useCallback(g=>{const c=Y(s,g);return q(g,c)},[s]),T=f.exports.useCallback(g=>{switch(g){case"copyAsText":{i();break}case"import":{a(!0);break}case"export":{d(!0);break}}},[t]);return u(x,{children:[e(L,{icon:e($e,{}),text:n("button.share"),value:void 0,buttonProps:l,onClick:T,options:[{key:"copyAsText",icon:e(J,{}),text:n("label.copyAsText"),value:"copyAsText"},{key:"export",icon:e(Oe,{}),text:n("label.dataExport"),value:"export"},{key:"import",icon:e(Ae,{}),text:n("label.dataImport"),value:"import"}]}),o&&e(Be,{confirmDialogTitle:n("fleetSetup.importConfirmTitle"),confirmWarning:n("fleetSetup.importConfirmWarning",{name:t.name}),createPreview:k,parseInput:m,onImport:Ye,onClose:()=>a(!1),onSelectFile:y}),h&&e(Ie,{fileName:t.name,jsonContent:JSON.stringify(_e(t)),onClose:()=>d(!1)})]})};function Ye(p){we(p),setTimeout(()=>{const t=new URL(window.location.href);window.location.href=`${t.origin}${t.pathname}#/fleetSetup/${p.key}`,window.location.reload()},0)}const qe=p=>{const{fleetSetups:t,fleetSetup:s,grouping:i,onChangeFleet:l,onChangeGrouping:o,onEdit:a,onShare:h}=p;return e(De,{left:d=>u(x,{children:[e(Te,{value:i,onChange:o,buttonProps:d}),e(Ke,{fleetSetups:t,fleetSetup:s,onChange:l,buttonProps:d}),e(E,{variant:"outlined",startIcon:e(ke,{}),onClick:a,...d,children:n("button.edit")},"edit")]}),right:d=>e(x,{children:e(Le,{fleetSetup:s,grouping:i,onCopyAsText:h,buttonProps:d})})})},Je=p=>{const{initialFleetKey:t}=p,s=f.exports.useMemo(()=>Fe(),[]),i=f.exports.useMemo(()=>{var l;return t&&(l=s.find(o=>o.key===t))!=null?l:s[0]},[t]);return{fleetSetups:s,fleetSetup:i}};var P={},Ue=B.exports;Object.defineProperty(P,"__esModule",{value:!0});var Q=P.default=void 0,Qe=Ue(A),Ze=I,Xe=(0,Qe.default)((0,Ze.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"}),"Info");Q=P.default=Xe;var M={},et=B.exports;Object.defineProperty(M,"__esModule",{value:!0});var Z=M.default=void 0,tt=et(A),nt=I,at=(0,tt.default)((0,nt.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"}),"Error");Z=M.default=at;function rt(p){var i;const t={hp:0,speed:1/0,warpSpeed:1/0,dpmShip:0,dpmAntiAir:0,dpmSiege:0,incomplete:!1};return{...p.reduce((l,o)=>{const a=W(o.shipDefinition,o.moduleSelection);if(!a)return{...l,incomplete:!0};const h=N(a,o.count,l);return o.carriedShips.reduce((d,y)=>{const m=W(y.shipDefinition,null);return m?N(m,y.count,d):{...d,incomplete:!0}},h)},t),warpSpeed:(i=ot(p))!=null?i:void 0}}function ot(p){const t=p.filter(l=>{var o,a;return Number.isFinite((a=(o=l.shipDefinition.defaultStats)==null?void 0:o.warpSpeed)!=null?a:NaN)});if(t.length===0)return null;const s=t.map(l=>{var o,a;return l.count*Number((a=(o=l.shipDefinition.defaultStats)==null?void 0:o.warpSpeed)!=null?a:NaN)}).reduce((l,o)=>l+o,0),i=t.map(l=>l.count).reduce((l,o)=>l+o,0);return Math.round(s/i)}const it=p=>{const{fleetSetup:t}=p,[s,i]=f.exports.useState(!1),{totalCost:l,shipCount:o,shipCountByType:a,shipCountByRow:h}=f.exports.useMemo(()=>Re(t.ships),[t.ships]),d=f.exports.useMemo(()=>rt(t.ships),[t.ships]),y=l>t.maxCost,m=t.totalReinforcementCount>t.maxReinforcement,k=f.exports.useMemo(()=>{const c=Ee(t);return Object.keys(c).map(v=>{const[S,X]=v.split("#"),ee=ne(S),_=$(ee),w=c[v];switch(X){case"self":return n("fleetSetup.reinforcementShipWithValidationError",{shipName:_,reinforcementType:n("fleetSetup.selfReinforcement"),errorText:w});case"ally":return n("fleetSetup.reinforcementShipWithValidationError",{shipName:_,reinforcementType:n("fleetSetup.orgReinforcementA"),errorText:w});case"ally2":return n("fleetSetup.reinforcementShipWithValidationError",{shipName:_,reinforcementType:n("fleetSetup.orgReinforcementB"),errorText:w});case"ally3":return n("fleetSetup.reinforcementShipWithValidationError",{shipName:_,reinforcementType:n("fleetSetup.orgReinforcementC"),errorText:w});default:return n("fleetSetup.shipWithValidationError",{shipName:_,errorText:w})}})},[t]),g=y||m||k.length>0?e(Z,{color:"error"}):e(Q,{color:"primary"});return u(ae,{expanded:s,onChange:()=>i(!s),children:[e(re,{expandIcon:s?e(oe,{}):g,children:u(C,{spacing:1,children:[e(r,{variant:"body1",children:t.name}),!s&&u("div",{children:[u(r,{variant:"body2",color:"text.secondary",component:"span",children:[n("fleetSetup.reinforcementColon"),F()?" ":""]}),e(r,{variant:"body2",color:"text.secondary",component:"span",sx:m?{color:"red"}:{},children:`${t.totalReinforcementCount} / ${t.maxReinforcement}`}),u(r,{variant:"body2",color:"text.secondary",component:"span",children:[n("fleetSetup.commaCommandPointColon"),F()?" ":""]}),e(r,{variant:"body2",color:"text.secondary",component:"span",sx:y?{color:"red"}:{},children:`${l} / ${t.maxCost}`})]})]})}),e(ie,{children:s&&e(le,{rows:[{key:"reinforcementCount",label:n("fleetSetup.reinforcement"),value:e(r,{variant:"body2",sx:m?{color:"red"}:{},children:`${t.totalReinforcementCount} / ${t.maxReinforcement}`})},{key:"cost",label:n("fleetSetup.totalFleetCommandPoints"),value:e(r,{variant:"body2",sx:y?{color:"red"}:{},children:`${l} / ${t.maxCost}`})},{key:"dpm",label:n("fleetSetup.totalFleetDpm"),value:u(x,{children:[e(r,{variant:"body2",children:se(d)}),d.incomplete&&e(r,{variant:"caption",color:"text.secondary",children:n("fleetSetup.inaccurateDueToMissingDataBrackets")})]})},{key:"hp",label:n("fleetSetup.totalFleetHp"),value:u(x,{children:[e(r,{variant:"body2",children:ce(d)}),d.incomplete&&e(r,{variant:"caption",color:"text.secondary",children:n("fleetSetup.inaccurateDueToMissingDataBrackets")})]})},{key:"speed",label:n("label.speed"),value:u(x,{children:[e(r,{variant:"body2",children:pe(d)}),d.incomplete&&e(r,{variant:"caption",color:"text.secondary",children:n("fleetSetup.inaccurateDueToMissingDataBrackets")})]})},{key:"shipCount",label:n("label.ships"),value:o>0?u(x,{children:[e(r,{variant:"body2",children:n("fleetSetup.totalShipCountValue",{value:o})}),Object.keys(a).filter(c=>a[c]>0&&c!==b.CORVETTE&&c!==b.FIGHTER).map(c=>e(r,{variant:"body2",children:n("fleetSetup.countPerKind",{kind:R(c),value:a[c]})},c))]}):e(r,{variant:"body2",children:"-"})},{key:"carriedShipCount",label:n("shipType.aircraft"),value:a[b.FIGHTER]+a[b.CORVETTE]>0?u(x,{children:[a[b.FIGHTER]>0&&e(r,{variant:"body2",children:n("fleetSetup.countPerKind",{kind:R(b.FIGHTER),value:a[b.FIGHTER]})}),a[b.CORVETTE]>0&&e(r,{variant:"body2",children:n("fleetSetup.countPerKind",{kind:R(b.CORVETTE),value:a[b.CORVETTE]})})]}):e(r,{variant:"body2",children:"-"})},{key:"rowCount",label:n("label.rowPlacement"),value:o>0?e(x,{children:Object.keys(h).filter(c=>c!==de.NONE&&h[c]>0).map(c=>e(r,{variant:"body2",children:n("fleetSetup.countPerKind",{kind:ue(c),value:h[c]})},c))}):e(r,{variant:"body2",children:"-"})},...k.length>0?[{key:"warnings",label:n("label.warning"),value:k.map((c,v)=>e(r,{variant:"body2",sx:{color:"red"},children:c},`warning_${v}`))}]:[]]})})]})},K=p=>{const{shipSelections:t}=p,{openShipDetailDialog:s}=he();return e(C,{spacing:1,children:t==null?void 0:t.map(i=>{var l,o;return u(f.exports.Fragment,{children:[u(C,{spacing:1,direction:"row",children:[u(C,{spacing:1,direction:"row",flexWrap:"wrap",sx:{flexGrow:1},children:[e(D,{component:"div",sx:{width:"25px"},children:e(r,{variant:"body2",textAlign:"end",children:`${i.count}\xD7`})}),e(r,{variant:"body2",children:e(j,{onClick:()=>{s(i.shipDefinition.id)},children:$(i.shipDefinition)})}),i.reinforcement==="self"&&e(r,{variant:"body2",noWrap:!0,children:n("fleetSetup.reinforcementBrackets")}),i.reinforcement==="ally"&&e(r,{variant:"body2",noWrap:!0,children:n("fleetSetup.orgReinforcementABrackets")}),i.reinforcement==="ally2"&&e(r,{variant:"body2",noWrap:!0,children:n("fleetSetup.orgReinforcementBBrackets")}),i.reinforcement==="ally3"&&e(r,{variant:"body2",noWrap:!0,children:n("fleetSetup.orgReinforcementCBrackets")})]}),e(D,{component:"div",sx:{width:"50px"},children:i.reinforcement===null&&e(r,{variant:"body2",textAlign:"end",children:`${((l=i.costOverride)!=null?l:i.shipDefinition.cost)*i.count} Pt`})})]}),i.carriedShips.map(a=>{var h;return u(C,{spacing:1,direction:"row",flexWrap:"wrap",children:[e(r,{variant:"body2",color:"text.secondary",sx:{paddingLeft:"30px",opacity:.5},children:"\u2517"}),e(D,{component:"div",sx:{width:"25px"},children:e(r,{variant:"body2",textAlign:"end",children:`${a.count}\xD7`})}),e(r,{variant:"body2",children:e(j,{onClick:()=>{s(a.shipDefinition.id)},children:$(a.shipDefinition)})})]},`${a.shipDefinition.id}_${(h=a.reinforcement)!=null?h:"initial"}`)})]},`${i.shipDefinition.id}_${(o=i.reinforcement)!=null?o:"initial"}`)})})},lt=p=>{const{fleetSetup:t,groupedShips:s,onClose:i}=p,[l,o]=f.exports.useState(!1),[a,h]=f.exports.useState(()=>q(t,s)),d=()=>{a&&me(a).then(()=>{o(!0)})},y=k=>{h(k.target.value)},m=()=>{i(),o(!1)};return e(Me,{title:n("button.share"),content:u(C,{spacing:1,children:[e(We,{variant:"filled",id:"outlined-multiline-static",multiline:!0,onChange:y,rows:10,defaultValue:a,fullWidth:!0}),!!navigator.clipboard&&e(E,{variant:"outlined",startIcon:l?e(fe,{}):e(J,{}),onClick:d,fullWidth:!0,children:n("button.copyToClipboard")})]}),actions:e(E,{variant:"outlined",onClick:m,children:n("button.close")}),onClose:m})},Rt=()=>{const p=Se(),{fleetKey:t}=ve(),s=ye(),i=ge(s.breakpoints.up("lg")),[l,o]=f.exports.useState(!1),{fleetSetups:a,fleetSetup:h}=Je({initialFleetKey:t!=null?t:null}),[d,y]=f.exports.useState(H.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME),m=f.exports.useMemo(()=>Y(d,h),[h,d]),k=S=>{p(G.fleetSetupByKey.path(S))},T=()=>{p(G.fleetSetupEditByKey.path(h.key))},g=()=>{o(!0)},c=()=>{o(!1)},v=i&&m.groupedBy===H.GROUP_BY_ROW_SORT_BY_TYPE_AND_NAME?"row":"column";return u(x,{children:[e(be,{currentRoute:"/fleetSetup"}),e(qe,{fleetSetups:a,fleetSetup:h,grouping:d,onChangeFleet:k,onChangeGrouping:y,onEdit:T,onShare:g}),e(Ce,{disableContainer:v==="row",children:e(D,{component:"div",p:1,children:u(C,{spacing:1,children:[e(it,{fleetSetup:h}),h.ships.length>0?e(x,{children:v==="row"?e(C,{spacing:1,direction:"row",sx:{width:"100%"},children:m.groups.map(S=>e(V,{sx:{width:`${100/m.groups.length}%`},children:e(D,{component:"div",p:1,children:u(C,{spacing:1,children:[u(r,{variant:"body1",children:[S.name,F()&&e("span",{children:"\xA0"}),S.count>0?n("fleetSetup.shipCountBrackets",{value:S.count}):""]}),e(xe,{}),e(K,{shipSelections:S.ships})]})})},S.id))}):e(Pe,{expandables:m.groups.map(S=>({id:S.id,initiallyOpened:!0,summary:u(r,{variant:"body1",children:[S.name,F()&&e("span",{children:"\xA0"}),S.count>0?n("fleetSetup.shipCountBrackets",{value:S.count}):""]}),details:e(K,{shipSelections:S.ships}),skip:S.ships.length===0}))},m.groupedBy)}):e(V,{children:e(D,{component:"div",p:2,children:u(C,{spacing:1,children:[e(r,{variant:"body1",children:n("fleetSetup.fleetFormation")}),e(je,{severity:"info",children:n("fleetSetup.fleetEmptyNotice")})]})})}),e(r,{variant:"caption",align:"right",paragraph:!0,children:n("fleetSetup.pageFootnote")})]})})}),l&&e(lt,{fleetSetup:h,groupedShips:m,onClose:c}),e(Ne,{disableContainer:v==="row"})]})};export{Rt as FleetSetupPage,Rt as default};
